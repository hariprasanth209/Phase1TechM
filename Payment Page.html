<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment Page</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="Assets/CSS/payy.css">
<body>
  <div class="payment-container">
    <!-- Selected Plan Section -->
    <div class="selected-plan">
    <h3 class="mb-3">Selected Plan </h3>
    <p><strong>Price: </strong><span id="planPrice"></span></p>
    <p><strong>Data: </strong><span id="planData"></span></p>
    <p><strong>Validity: </strong><span id="validDays"></span></p>
    <p><strong>Phone: </strong><span id="phone"></span></p>
    <div class="icon-container">
        <img src="Assets/CSS/pngaaa.com-5863036.png" alt="ji">
    </div>
    </div>

    <!-- Payment Options Grid -->
    <h4 class="mb-4 text-center ">Choose Payment Method</h4>
    <div class="rad-container">
        <label class="rad-label">
            <input type="radio" class="rad-input" name="rad" onclick="showForm('upiForm'); changeBackground('OIP.jpg')" checked>
            <div class="rad-design"></div>
            <div class="rad-text">UPI</div>
        </label>
    
        <label class="rad-label">
            <input type="radio" class="rad-input" name="rad" onclick="showForm('netbankingForm'); changeBackground('netbank.jpg')">
            <div class="rad-design"></div>
            <div class="rad-text">Net Banking</div>
        </label>
    
        <label class="rad-label">
            <input type="radio" class="rad-input" name="rad" onclick="showForm('cardForm'); changeBackground('creditcard.jpg')">
            <div class="rad-design"></div>
            <div class="rad-text">Card</div>
        </label>
    
        <label class="rad-label">
            <input type="radio" class="rad-input" name="rad" onclick="showForm('walletForm'); changeBackground('Wallet.jpg')">
            <div class="rad-design"></div>
            <div class="rad-text">Wallet</div>
        </label>
    </div>
    

    <!-- Payment Forms -->
    <div class="payment-form" id="upiForm">
      <h5>UPI Payment</h5>
      <div class="mb-3">
        <label for="upiId" class="form-label">Enter UPI ID</label>
        <input type="text" class="form-control" id="upiId" placeholder="example@upi">
      </div>
      <button class="button-33" onclick="savePaymentDetails('UPI')">Submit</button>
    </div>

    <div class="payment-form" id="netbankingForm">
      <h5>Net Banking</h5>
      <div class="mb-3">
        <label for="accountNumber" class="form-label">Enter Account Number</label>
        <input type="text" class="form-control" id="accountNumber" placeholder="1234567890">
      </div>
      <button class="button-33" onclick="savePaymentDetails('Net Banking')">Submit</button>
    </div>

    <div class="payment-form" id="cardForm">
      <h5>Credit/Debit Card</h5>
      <div class="mb-3">
        <label for="cardNumber" class="form-label">Card Number</label>
        <input type="text" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456">
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="expiryDate" class="form-label">Expiry Date (MM/YY)</label>
          <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY">
        </div>
        <div class="col-md-6 mb-3">
          <label for="cvv" class="form-label">CVV</label>
          <input type="text" class="form-control" id="cvv" placeholder="123">
        </div>
      </div>
      <button class="button-33" onclick="savePaymentDetails('Credit/Debit Card')">Submit</button>
    </div>

    <div class="payment-form" id="walletForm">
      <h5>Wallet Payment</h5>
      <div class="mb-3">
        <label for="walletId" class="form-label">Enter Wallet ID</label>
        <input type="text" class="form-control" id="walletId" placeholder="Wallet ID">
      </div>
      <button class="button-33" onclick="savePaymentDetails('Wallet')">Submit</button>
    </div>
  </div>
<!-- FAQ Section -->
<div class="container-fluid py-5" id="FAQS">
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8 bg-light rounded-4 p-3"> <!-- Adjust width for responsiveness -->
            <h1 class="display-5 text-center fw-bold text-dark mb-4">Frequently Asked Questions</h1>
            <div class="accordion accordion-flush" id="accordionFlushExample2">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingFour">
                        <button class="accordion-button collapsed faq-question" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseFour" aria-expanded="false" aria-controls="flush-collapseFour">
                            <i class="fa-solid fa-circle-question me-2"></i> Q1: What payment methods are accepted?
                        </button>
                    </h2>
                    <div id="flush-collapseFour" class="accordion-collapse collapse" aria-labelledby="flush-headingFour" data-bs-parent="#accordionFlushExample2">
                        <div class="accordion-body faq-answer">
                            We accept payments via <strong>debit/credit cards, UPI, and net banking.</strong>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingFive">
                        <button class="accordion-button collapsed faq-question" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseFive" aria-expanded="false" aria-controls="flush-collapseFive">
                            <i class="fa-solid fa-circle-question me-2"></i> Q2: My recharge failed, but the amount was deducted. What should I do?
                        </button>
                    </h2>
                    <div id="flush-collapseFive" class="accordion-collapse collapse" aria-labelledby="flush-headingFive" data-bs-parent="#accordionFlushExample2">
                        <div class="accordion-body faq-answer">
                            If your recharge fails but the amount is deducted, it will be <strong>automatically refunded within 2-5 working days.</strong> If not, please contact our support team.
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingSix">
                        <button class="accordion-button collapsed faq-question" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseSix" aria-expanded="false" aria-controls="flush-collapseSix">
                            <i class="fa-solid fa-circle-question me-2"></i> Q3: Can I cancel a recharge after payment?
                        </button>
                    </h2>
                    <div id="flush-collapseSix" class="accordion-collapse collapse" aria-labelledby="flush-headingSix" data-bs-parent="#accordionFlushExample2">
                        <div class="accordion-body faq-answer">
                            No, once a recharge is processed, <strong>it cannot be canceled or refunded.</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- FontAwesome for icons -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"></script>

  <!-- Bootstrap JS and Popper.js -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
  <!-- Custom JS -->
  <script>
    // Automatically show the UPI form on page load
    window.onload = function () {
      showForm('upiForm');
    };

    function showForm(formId) {
      // Hide all forms
      document.querySelectorAll('.payment-form').forEach(form => {
        form.style.display = 'none';
      });

      // Show the selected form
      const selectedForm = document.getElementById(formId);
      if (selectedForm) {
        selectedForm.style.display = 'block';
      }
    }

   // Display plans in card
document.addEventListener("DOMContentLoaded", function () {
  // Retrieve the logged-in and guest mobile numbers from localStorage
  const loggedInMobile = localStorage.getItem("loggedInMobile");
  const guestMobile = localStorage.getItem("guestMobile");
  const phone = guestMobile || loggedInMobile;
  const phoneElement = document.getElementById("phone");
  if (phone) {
    phoneElement.innerText = phone;
  } else {
    phoneElement.innerText = "No mobile number found.";
  }

  // Get plan ID from URL params
  const urlParams = new URLSearchParams(window.location.search);
  const planId = urlParams.get('id');

  if (planId) {
    fetch(`http://localhost:8003/api/plans/${planId}`)
      .then(response => {
        if (!response.ok) {
          throw new Error("Plan not found");
        }
        return response.json();
      })
      .then(plan => {
        // Display fetched plan details
        document.getElementById("planPrice").innerText = `â‚¹${plan.price}`;
        document.getElementById("planData").innerText = plan.data;
        document.getElementById("validDays").innerText = `${plan.validityDays} days`;

        // Store plan details in localStorage for later use
        localStorage.setItem("selectedPlan", JSON.stringify(plan));
      })
      
      .catch(error => console.error("Error fetching plan:", error));
  } else {
    console.error("No plan ID found in URL");
  }
});

function savePaymentDetails(paymentMode) {
  // Retrieve plan details from localStorage
  const plan = JSON.parse(localStorage.getItem("selectedPlan"));
  if (!plan) {
    console.error("Plan details not found");
    alert("Plan details not found. Please select a plan.");
    return;
  }

  // Prepare payment data
  const paymentData = {
    payMethod: paymentMode,
    rechargePhNo: localStorage.getItem("guestMobile") || localStorage.getItem("loggedInMobile") || null,
    userId: localStorage.getItem("guestId") || localStorage.getItem("userID") || null,
    amount: plan.price,
    planId: plan.planId
  };

  // Send payment data to the backend
  fetch('http://localhost:8003/api/payment-history', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(paymentData)
  })
    .then(response => {
      if (!response.ok) {
        throw new Error("Failed to create payment history");
      }
      return response.json();
    })
    .then(data => {
      console.log('Success:', data);
      alert('Payment History created successfully!');

      // Clear the display card
      clearDisplayCard();

      // Clear all localStorage items except loggedInMobile
      const loggedInMobile = localStorage.getItem("loggedInMobile"); // Save loggedInMobile
      localStorage.removeItem("guestId"); 
      localStorage.removeItem("guestMobile");
      localStorage.removeItem("plan");
    })
    .catch((error) => {
      console.error('Error:', error);
      alert('Failed to create Payment History.');
    });
}

// Function to clear the display card
function clearDisplayCard() {
  // Clear the phone number display
  document.getElementById("phone").innerText = "";

  // Clear the plan details display
  document.getElementById("planPrice").innerText = "";
  document.getElementById("planData").innerText = "";
  document.getElementById("validDays").innerText = "";
}

    // background image change
    function changeBackground(imageName) {
    // Select the background element
    let bgElement = document.querySelector(".body-bg");

    // If it doesn't exist, create it
    if (!bgElement) {
        bgElement = document.createElement("div");
        bgElement.classList.add("body-bg");
        document.body.prepend(bgElement);
    }

    // Change the background image dynamically
    bgElement.style.backgroundImage = `url('Assets/Images/${imageName}')`;
}

// Ensure the default background is set when the page loads
document.addEventListener("DOMContentLoaded", function () {
    changeBackground('OIP.jpg'); // Default background for UPI
});

  </script>
  <script src="https://kit.fontawesome.com/your-kit-code.js" crossorigin="anonymous"></script>
</body>
</html>